# RunningHub 工作流浏览器 - 使用说明

## 🚀 快速开始

### 0.1 即时访问

https://comfyuilist.nicoy.cn/

### 1. 激活 conda 环境并安装依赖

```bash
# 进入项目目录
cd runninghub-workflow

# 激活你创建的 conda 环境
conda activate runninghub

# 安装依赖
pip install -r requirements.txt
```

### 2. 启动服务

```bash
python app.py
```

首次运行会自动获取初始数据（可能需要几分钟），然后启动 Web 服务器。

### 3. 访问界面

在浏览器中打开：**http://127.0.0.1:5000**

---

## 📖 功能说明

### 1. 查看工作流数据

- 页面会自动加载最新的工作流数据
- 每个卡片显示：
  - 工作流预览图
  - 名称
  - ❤️ 点赞数
  - 🔥 使用次数
  - ⭐ 收藏数
- 点击「查看详情」可跳转到 RunningHub 网站

### 2. 刷新数据（重要功能）

点击页面上的「🔄 刷新数据」按钮：

- ✅ 后台自动获取最新数据
- ✅ 显示实时进度条
- ✅ **不会影响你当前的浏览**
- ✅ 完成后自动更新文件列表
- ✅ 你可以在下拉菜单中切换到新数据

### 3. 查看历史数据

使用「选择数据时间」下拉菜单：

- 选择不同时间点的数据
- 对比不同时期的热门工作流
- 分析趋势变化

---

## 🎯 核心特性

### 智能数据采集

1. **动态分页**

   - 自动检测总页数（不使用固定值）
   - 适应数据量的实时变化
   - 确保获取所有数据

2. **模拟真人请求**

   - 基础延迟：1.5-3.0 秒（随机）
   - 抖动算法：0.3-1.0 秒（高斯分布）
   - 避免被服务器限流

3. **智能排序**
   - 主排序：按点赞数降序
   - 次排序：按使用次数降序
   - 显示最受欢迎的工作流

### 数据管理

- **自动保存**：每次采集都保存为独立的 JSON 文件
- **时间戳命名**：文件名格式 `workflows_YYYYMMDDHHMM.json`
  - 例如：`workflows_202501291430.json`（2025 年 1 月 29 日 14:30）
- **历史保留**：不会覆盖旧数据，可以查看历史记录

---

## ⚙️ 技术细节

### 项目结构

```
runninghub-workflow/
├── app.py                 # 主程序（集成采集和Web服务）
├── fetch_workflows.py     # 数据采集模块
├── requirements.txt       # 依赖列表
├── README.md             # 项目说明
├── 使用说明.md            # 本文件
├── data/                 # 数据存储目录（自动创建）
│   └── workflows_*.json  # 数据文件
└── templates/            # HTML 模板
    └── index.html       # Web 界面
```

### 数据文件格式

```json
{
  "fetch_time": "2025-01-29T14:30:00.123456",
  "total_count": 513,
  "workflows": [
    {
      "id": "工作流ID",
      "name": "工作流名称",
      "desc": "描述",
      "preview": {
        "url": "预览图URL",
        "thumbnailUri": "缩略图URL"
      },
      "statisticsInfo": {
        "likeCount": "点赞数",
        "useCount": "使用次数",
        "collectCount": "收藏数"
      },
      "owner": {
        "name": "作者名称"
      },
      "tags": [...]
    }
  ]
}
```

---

## ⚠️ 常见问题

### Q1: 提示 Authorization 错误怎么办？

**A:** Token 可能已过期，需要更新：

1. 打开浏览器，访问 RunningHub 并登录
2. 按 F12 打开开发者工具
3. 切换到 Network 标签
4. 在网站上搜索「换装」触发请求
5. 找到 `workflow` 请求，查看 Request Headers
6. 复制 `Authorization` 的值
7. 编辑 `fetch_workflows.py`，更新第 30 行的 `authorization` 字段

### Q2: 刷新数据时可以关闭浏览器吗？

**A:** 可以！刷新是在服务器后台进行的，即使关闭浏览器也会继续执行。重新打开页面后，可以在下拉菜单中看到新数据。

### Q3: 数据文件占用空间大吗？

**A:** 每个文件大约 1-3 MB，可以定期删除旧文件：

```bash
# 删除指定日期之前的数据
cd data/
rm workflows_202501*.json  # 删除1月份的数据
```

### Q4: 如何修改搜索关键词？

**A:** 编辑 `app.py`，找到第 73 行的 `refresh_data_background` 函数，修改默认参数：

```python
def refresh_data_background(search="你的关键词"):
```

### Q5: 可以修改服务器端口吗？

**A:** 可以，编辑 `app.py` 最后一行：

```python
run_server(host='127.0.0.1', port=8080)  # 改为 8080 端口
```

---

## 🔧 高级配置

### 修改延迟参数

编辑 `fetch_workflows.py` 第 135-136 行：

```python
base_delay = random.uniform(2.0, 4.0)  # 增加基础延迟
jitter = random.uniform(0.5, 1.5)      # 增加抖动范围
```

### 修改每页数量

编辑 `fetch_workflows.py` 第 91 行：

```python
def fetch_all_workflows(self, search="换装", size=50, callback=None):
```

---

## 📊 使用建议

1. **定期刷新**：建议每天或每周刷新一次数据，追踪热门趋势
2. **保留历史**：保留关键时间点的数据文件，方便对比分析
3. **备份数据**：定期备份 `data/` 目录，防止数据丢失
4. **监控日志**：运行时注意终端输出，及时发现问题

---

## 💡 提示

- 首次运行会获取初始数据，请耐心等待
- 刷新数据时可以继续浏览，不会被打断
- 数据文件是纯文本 JSON，可以用任何文本编辑器查看
- 如果遇到问题，查看终端输出的错误信息

---

**祝使用愉快！** 🎉

如有问题，请查看终端输出或检查 `fetch_workflows.py` 中的 Token 配置。
